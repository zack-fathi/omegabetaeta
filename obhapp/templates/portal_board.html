<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Members</title>
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <section id="board"></section>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function Board() {
            const [boardMembers, setBoardMembers] = useState([]);
            const [brothers, setBrothers] = useState([]);
            const [editingRole, setEditingRole] = useState(null);
            const [newMember, setNewMember] = useState('');

            useEffect(() => {
                fetchBoardMembers();
                fetchBrothers();
            }, []);

            const fetchBoardMembers = async () => {
                const response = await axios.get('/portal/board/');
                setBoardMembers(response.data);
            };

            const fetchBrothers = async () => {
                const response = await axios.get('/api/brothers'); // Assume you have an endpoint for fetching brothers
                setBrothers(response.data);
            };

            const handleUpdate = async (roleName) => {
                const response = await axios.post('/portal/board/update', {
                    role_name: roleName,
                    user_id: newMember
                });

                if (response.data.success) {
                    fetchBoardMembers();
                    setEditingRole(null);
                } else {
                    alert(response.data.message);
                }
            };

            return (
                <div>
                    <h2>Board Members</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Role Name</th>
                                <th>Member Name</th>
                                {session.role in ['Admin', 'President', 'Internal Vice President', 'External Vice President'] && <th>Actions</th>}
                            </tr>
                        </thead>
                        <tbody>
                            {boardMembers.map(member => (
                                <tr key={member.role_name}>
                                    <td>{member.role_name}</td>
                                    <td>{member.fullname}</td>
                                    {session.role in ['Admin', 'President', 'Internal Vice President', 'External Vice President'] &&
                                        <td>
                                            {editingRole === member.role_name ? (
                                                <>
                                                    <select value={newMember} onChange={(e) => setNewMember(e.target.value)}>
                                                        {brothers.map(brother => (
                                                            <option key={brother.user_id} value={brother.user_id}>
                                                                {brother.fullname}
                                                            </option>
                                                        ))}
                                                    </select>
                                                    <button onClick={() => handleUpdate(member.role_name)}>Save</button>
                                                    <button onClick={() => setEditingRole(null)}>Cancel</button>
                                                </>
                                            ) : (
                                                <button onClick={() => setEditingRole(member.role_name)}>Edit</button>
                                            )}
                                        </td>
                                    }
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        ReactDOM.render(<Board />, document.getElementById('board'));
    </script>
</body>
</html>
